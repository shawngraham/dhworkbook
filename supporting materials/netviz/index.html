<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>igraph - HIST3814o Crafting Digital History</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "igraph";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> HIST3814o Crafting Digital History</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../introduction/crafting-digital-history/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>1. Open Access Research</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-1/Open-Access-Research/">Why you should be open</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-1/Exercises/">Exercises</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>2. Finding Data</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-2/Finding Data/">How do we find data?</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-2/Exercises/">Exercises</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>3. Fixing Data</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-3/Wrangling Data/">Data is messy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-3/Exercises/">Exercises</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>4. Analysis</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-4/Seeing Patterns/">Seeing Patterns</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-4/Exercises/">Exercises</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>5. Visualization</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-5/Humanities Visualization/">Communicating your Findings</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../module-5/Exercises/">Exercises</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../conclusion/conclusion/">6. Final Thoughts</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Appendices</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tei/">Text Encoding</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ner/">NER</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../open-refine/">Open Refine</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../regex/">Regular Expressions (regex)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../regex-ner/">Going further with regex</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../regexex/">Regex & the Republic of Texas</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cyoa.txt/">CYOA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../geoparsing-w-python.txt/">Geoparsing with Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../gephi.txt/">SNA with Gephi</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../graphing-the-net.txt/">Graphing the Net</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../multimode-networks.txt/">Multimode Networks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../leaflet.txt/">Leaflet</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../glitch/">Glitch</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../quick-intro-r/">Quick Intro to R</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../git-rstudio/">Git</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../topicmodel-r-dhbox/">TM, DHBox</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../topicmodel-r-yourmachine/">TM, Local</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">igraph</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#using-igraph-to-visualize-network-data">Using igraph to visualize network data</a></li>
                
                    <li><a class="toctree-l4" href="#installing-igraph">Installing igraph</a></li>
                
                    <li><a class="toctree-l4" href="#getting-the-data-into-your-project">getting the data into your project</a></li>
                
            
                <li class="toctree-l3"><a href="#examine-data">examine data</a></li>
                
            
                <li class="toctree-l3"><a href="#which-gives-the-number-of-nodes-in-our-data">which gives the number of nodes in our data</a></li>
                
            
                <li class="toctree-l3"><a href="#which-gives-the-number-of-sources-and-number-of-targets">which gives the number of sources, and number of targets</a></li>
                
            
                <li class="toctree-l3"><a href="#which-means-some-people-sent-more-than-one-letter-and-some-people-received-more-than-one-letter">which means some people sent more than one letter, and some people received more than one letter</a></li>
                
                    <li><a class="toctree-l4" href="#visualization">Visualization</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">HIST3814o Crafting Digital History</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendices &raquo;</li>
        
      
    
    <li>igraph</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="using-igraph-to-visualize-network-data">Using igraph to visualize network data</h1>
<p>In this exercise, we are doing a quick first pass on the network data generated from the Republic of Texas correspondence. I am providing you with the <em>edge list</em>, the links of to - from that we generated earlier. I am also providing you the <em>node list</em>, the list of individuals extracted from that edge list. If we keep our nodes and edges separated in csv tables, we can add other <em>attributes</em> later (things like date, or number of times a pair of individuals corresponded ie weight, or gender, or location, or what have you) to create different views or analyses. I used open refine (see the <a href="../open-refine/">lesson on open refine</a>) to clean this data up for you. Remember, 80 percent of all digital history work involves cleaning data!</p>
<p>Here is the data that you need; download these, and use the filemanager to load them into your dhbox into your new R project for this tutorial.</p>
<ul>
<li><a href="../../supporting materials/texaslinks.csv">list of links</a></li>
<li><a href="../../supporting materials/texasnodes.csv">list of nodes</a></li>
</ul>
<p>This tutorial will illustrate to you some of the ways the <code>igraph</code> package can be used to create quick visualizations or to generate network statistics. These of course on their own mean very little: this is where your historical sensibility comes into play, triangulating this generated data with other things you know about the historical context of the time, place and players!</p>
<p>Remember to make a new project in RStudio by clicking the down arrow on the R button at the right hand side of the R Studio interface; start the project in a new folder. Then using the DHBox filemanager, upload the nodes and links data from your computer to that folder you just created.</p>
<h2 id="installing-igraph">Installing igraph</h2>
<p>Once that's accomplished, go back into R Studio and start a new script:</p>
<pre><code class="R"># install igraph; this might take a long time
# you only run this line the first time you install igraph:
install.packages('igraph')

# a lot of stuff gets downloaded and installed.

# now tell RStudio you want to use the igraph pacakge and its functions:
library('igraph')
</code></pre>

<h2 id="getting-the-data-into-your-project">getting the data into your project</h2>
<p>For future reference, we're adapting our script from a more in-depth <a href="http://kateto.net/networks-r-igraph">tutorial</a>.</p>
<p>Bringing data into R is straightforward. We create a variable 'nodes' and a variable for 'links' and load the data from our csv files into them:</p>
<pre><code class="R"># now let's load up the data by putting the csv files into nodes and links.
nodes &lt;- read.csv(&quot;texasnodes.csv&quot;, header=T, as.is=T)
links &lt;- read.csv(&quot;texaslinks.csv&quot;, header=T, as.is=T)
</code></pre>

<p>We can examine the start or end of a variable with the head or tail command; these look at the first few lines at the start ('head') or end ('tail') of the variable, eg:</p>
<p>``R</p>
<h1 id="examine-data">examine data</h1>
<p>head(nodes)</p>
<p>head(links)</p>
<p>nrow(nodes); length(unique(nodes$id))</p>
<h1 id="which-gives-the-number-of-nodes-in-our-data">which gives the number of nodes in our data</h1>
<p>nrow(links); nrow(unique(links[,c("source", "target")]))</p>
<h1 id="which-gives-the-number-of-sources-and-number-of-targets">which gives the number of sources, and number of targets</h1>
<h1 id="which-means-some-people-sent-more-than-one-letter-and-some-people-received-more-than-one-letter">which means some people sent more than one letter, and some people received more than one letter</h1>
<pre><code>Let's rearrange things so that instead of this:

Alice -&gt; Bob, 1 letter
Alice -&gt; Bob, 1 letter
Alice -&gt; Bob, 1 letter

we have this:

Alice -&gt; Bob, 3 letters

That is, we're going to count up the number of times a particular relationship exists, and assign that count to the weight column. Much tidier all around! We do that like this:

```R
links &lt;- aggregate(links[,3], links[,-3], sum)

links &lt;- links[order(links$from, links$to),]

colnames(links)[3] &lt;- &quot;weight&quot;

rownames(links) &lt;- NULL

head(links)
</code></pre>

<p>You should see this:</p>
<pre><code>&gt; head(links)
           source            target weight
1      James Webb       Abb6 Anduz6      1
2   A. de Saligny Abner S. Lipscomb      1
3     E. W. Moore Abner S. Lipscomb      1
4  James Hamilton Abner S. Lipscomb     14
5     James Treat Abner S. Lipscomb     11
6 Nathaniel Amory Abner S. Lipscomb      1

</code></pre>

<p>Now, let's tell R to stitch our links together into a network object (a data frame) that it can visualize and analyze:</p>
<pre><code class="R"># let's make a net
# notice that we are telling igraph that the network is directed, that the relationship Alice to Bob is different than Bob's to Alice (Alice is the _sender_, and Bob is the _receiver_)

net &lt;- graph_from_data_frame(d=links, vertices=nodes, directed=T)

# type 'net' again and run the line to see how the network is represented.
net

# let's visualizae it
plot(net, edge.arrow.size=.4,vertex.label=NA)

# two quite distinct groupings, it would appear.

</code></pre>

<p>Before we jump down the rabbit hole of visualization, let's recognize right now that <em>visualizing</em> a network is only rarely of analytical value. The value of network analysis comes from the various questions we can now start posing of our data when it is represented as a network. In this correspondence network, who is in the centre of the web? To whom would information flow? To whom would information leak? Are there cliques or ingroups? When we identify such individuals, how does that confirm or confound our expectations of the period and place?</p>
<p>Many different kinds of metrics can be calculated (and <a href="http://kateto.net/networks-r-igraph">this tutorial will show you how</a>) but it's always worth remembering that a metric is only meaningful for a given network when we're dealing with like things - a network of people who write letters to one another; a network of banks that swap mortgages with one another. These are called 'one mode networks'. A network of people connected to the banks they use - a two mode network, because it connects two different kinds of things - might be useful to <em>visualize</em> but the metrics calculated might not be <em>valid</em> if the metric was designed to work on a one-mode network (for more on this and allied issues, see <a href="http://www.scottbot.net/HIAL/index.html@p=6279.html">Scott Weingart</a>).</p>
<p>Given our correspondence network, let's imagine that 'closeness' (eg a measure of how central a person is) and 'betweenness' (a measure of how many different strands of the network pass through this person) are the most historically interesting. Further, we're going to try to determine if there are subgroups in our network, cliques.</p>
<pre><code class="R">## the 'degree' of a node is the count of its connections. In this code chunk, we calculate degree, then make both a histogram of the counts and a plot of the network where we size the nodes proportionately to their degree. What do we learn from these two visualizations?
deg &lt;- degree(net, mode=&quot;all&quot;)
hist(deg, breaks=1:vcount(net)-1, main=&quot;Histogram of node degree&quot;)
plot(net, vertex.size=deg*2, vertex.label = NA)
## write this info to file for safekeeping
write.csv(deg, 'degree.csv')
</code></pre>

<p>Now we'll look at closeness. If you know the width or <em>diameter</em> of your network (the maximum number of steps to get across it), then the node that is on average the shortest number of steps from all the others is the one that is most close. We calculate it like this:</p>
<pre><code class="R">closepeople &lt;- closeness(net, mode=&quot;all&quot;, weights=NA)
sort(closepeople, decreasing = T) # so that we see who is most close first
write.csv(closepeople, 'closeness.csv') # so we have it on file.

</code></pre>

<p>We can ask which individuals are hubs, and which are authorities. In the lingo, 'hubs' are individuals with many outgoing links (they <em>sent</em> lots of letters) while 'authorities' are individuals who <em>received</em> lots of letters. In the code below,</p>
<pre><code>hs &lt;- hub_score(net, weights=NA)$vector
as &lt;- authority_score(net, weights=NA)$vector

par(mfrow=c(1,2))

# vertex.label.cex sets the size of the label; play with the sizes until you see something appealing.
plot(net, vertex.size=hs*40, vertex.label.cex =.2, edge.arrow.size=.1, main=&quot;Hubs&quot;)
plot(net, vertex.size=as*20, vertex.label = NA, edge.arrow.size=.1, main=&quot;Authorities&quot;)
</code></pre>

<p>Can you work out what command to give to write the hub score or the authority scores to a file?</p>
<p>Let's look for 'modules' within this network. Broadly speaking, these are clumps of nodes that have more or less the same pattern of ties between them, <em>within</em> the group, than without.</p>
<pre><code class="R">cfg &lt;- cluster_fast_greedy(as.undirected(net))

lapply(cfg, function(x) write.table( data.frame(x), 'cfg.csv'  , append= T, sep=',' ))
</code></pre>

<p>We create a new variable called 'cfg' and get the 'cluster_fast_greedy' algorithm to perform its calculations. The next line writes the groups to a file, separating each group with an x. (If you tried 'write.csv' as before, you'll get an error message because the output of the algorithm gives a different kind of data type. R is fussy like this.) Examine that file - what groups do you spot? What might these mean, if you went back to the content of the original letters?</p>
<h2 id="visualization">Visualization</h2>
<p>The line below will plot out our network, colouring it by the communities discerned above:</p>
<pre><code>plot(cfg, net, vertex.size = 1, vertex.label.cex =.2, edge.arrow.size=.1, main=&quot;Communities&quot;)
</code></pre>

<p>You can export the plot by clicking on the 'export' button in the plot panel, to pdf or to png. But this is a pretty ugly network. We need to apply a <em>layout</em> to try to make it more visually understandable. There are many different layout options in igraph. We'll assign the layout we want to a variable, and then we'll give that variable to the plot command:</p>
<pre><code>l1 &lt;- layout_with_fr(net)
plot(cfg, net, layout=l1, vertex.size = 1, vertex.label.cex =.2, edge.arrow.size=.1, main=&quot;Communities&quot;)
</code></pre>

<p>The 'layout_with_fr' is calling the 'Fruchterman-Reingold' algorithm, a kind of layout that imagines each node as a repulsive power, pushing against all the other nodes (it's part of a family of layouts called 'Forced Atlast'). That also means that if you ran the plot command a couple of times, the nodes might end up in different places each time - they are jostling for relative position, and this positioning itself carries no meaning in and of itself (so if a node is at the top of the screen, or the centre of the screen, don't read that to mean anything about importance).</p>
<p>We'll finish with a piece of code that will draw thumbnails of your network using every possible layout in the package. This will give you a sense of which layouts might best suit the historical story you wish to tell. Good luck! Remember to save your script, and upload the entire project folder to your github repository.</p>
<pre><code>layouts &lt;- grep(&quot;^layout_&quot;, ls(&quot;package:igraph&quot;), value=TRUE)[-1]

# Remove layouts that do not apply to our graph.

layouts &lt;- layouts[!grepl(&quot;bipartite|merge|norm|sugiyama|tree&quot;, layouts)]

par(mfrow=c(3,3), mar=c(1,1,1,1))

for (layout in layouts) {

  print(layout)
  V(net)$label &lt;- NA
  l &lt;- do.call(layout, list(net))

  plot(net, edge.arrow.mode=0, layout=l, main=layout) }
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../topicmodel-r-yourmachine/" class="btn btn-neutral" title="TM, Local"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

The Crafting Digital History site is built with <a href="http://www.mkdocs.org">MkDocs</a> using a theme provided by <a href="https://readthedocs.org">Read the Docs</a>. All documents are available on <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages"> GitHub</a>. I thank Reclaim Hosting for their help, support, and example in getting this site up and running.
</footer>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
<script>
  $(document).ready(function(){
    // Target your .container, .wrapper, .post, etc.
    $(".section").fitVids();
  });
</script>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../topicmodel-r-yourmachine/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>

</body>
</html>
