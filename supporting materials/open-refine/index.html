<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Shawn Graham">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Open Refine - HIST3814o Crafting Digital History</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Open Refine";
    var mkdocs_page_input_path = "supporting materials/open-refine.md";
    var mkdocs_page_url = "/supporting materials/open-refine/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> HIST3814o Crafting Digital History</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../introduction/crafting-digital-history/">Getting Started</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">1. Open Access Research</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-1/Open-Access-Research/">Why you should be open</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-1/Exercises/">Exercises</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">2. Finding Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-2/Finding Data/">How do we find data?</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-2/Exercises/">Exercises</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">3. Fixing Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-3/Wrangling Data/">Data is messy</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-3/Exercises/">Exercises</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">4. Analysis</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-4/Seeing Patterns/">Seeing Patterns</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-4/Exercises/">Exercises</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">5. Visualization</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-5/Humanities Visualization/">Communicating your Findings</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-5/Exercises/">Capstone Exercise</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../conclusion/Conclusion/">6. Final Thoughts</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Appendices</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tei/">Text Encoding Initiative</a>
                </li>
                <li class="">
                    
    <a class="" href="../git-rstudio/">Git in RStudio</a>
                </li>
                <li class="">
                    
    <a class="" href="../regex/">Introduction to Regular Expressions (regex)</a>
                </li>
                <li class="">
                    
    <a class="" href="../regexex/">Regex & the Republic of Texas</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Open Refine</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#an-introduction-to-open-refine">An Introduction to Open Refine</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#install-open-refine">Install Open Refine</a></li>
        
            <li><a class="toctree-l4" href="#start-cleaning-our-texan-correspondence">Start Cleaning our Texan Correspondence</a></li>
        
            <li><a class="toctree-l4" href="#now-what">Now what?</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../ner/">Stanford Named Entity Recognizer</a>
                </li>
                <li class="">
                    
    <a class="" href="../regex-ner/">Going further with regex</a>
                </li>
                <li class="">
                    
    <a class="" href="../quick-intro-r/">Quick intro to R</a>
                </li>
                <li class="">
                    
    <a class="" href="../cyoa.txt/">Choose Your Own Adventure</a>
                </li>
                <li class="">
                    
    <a class="" href="../geoparsing-w-python.txt/">Geoparsing with Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../glitch/">Glitch</a>
                </li>
                <li class="">
                    
    <a class="" href="../gephi.txt/">Social Network Analysis with Gephi</a>
                </li>
                <li class="">
                    
    <a class="" href="../graphing-the-net.txt/">Graphing the Net</a>
                </li>
                <li class="">
                    
    <a class="" href="../topicmodel-r-dhbox/">Topic Modeling, DH Box</a>
                </li>
                <li class="">
                    
    <a class="" href="../topicmodel-r-yourmachine/">Topic Modeling, Local</a>
                </li>
                <li class="">
                    
    <a class="" href="../netviz/">Network visualization with igraph</a>
                </li>
                <li class="">
                    
    <a class="" href="../inkscape/">Inkscape</a>
                </li>
                <li class="">
                    
    <a class="" href="../gh-pages/">GitHub Pages</a>
                </li>
                <li class="">
                    
    <a class="" href="../leaflet.txt/">Leaflet</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">HIST3814o Crafting Digital History</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendices &raquo;</li>
        
      
    
    <li>Open Refine</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages/edit/master/docs/supporting materials/open-refine.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="an-introduction-to-open-refine">An Introduction to Open Refine</h1>
<p><strong>This text was adopted from the first drafts of The Macroscope</strong></p>
<p>An alternative Open Refine exercise is offered by <a href="http://thomaspadilla.org/dataprep/">Thomas Padilla</a> and you may wish to give it a try instead. That would be acceptable.</p>
<h2 id="install-open-refine">Install Open Refine</h2>
<p>Open Refine (formerly Google Refine) is a powerful tool for working with messy data: cleaning it; transforming it from one format into another; extending it with web services; and linking it to databases like <a href="https://developers.google.com/freebase/">Freebase</a> (deprecated as of August 2016).</p>
<p>This exercise <strong>does not use</strong> DH Box.</p>
<p>In this exercise, we are going to use the Open Refne tool that originated with Google. Since 2012, it has been open source and freely available online. Using it takes a bit of getting used to, however.</p>
<p>Start by doing the following:</p>
<ol>
<li>Visit the <a href="http://openrefine.org">Open Refine home page</a> and watch the three videos. </li>
<li>Download <a href="http://openrefine.org/download.html">Open Refine to your machine</a>.</li>
<li>Follow the installation instructions. </li>
<li>Start Open Refine by double clicking on its icon. This will open a new browser window, pointing to <code>http://127.0.0.1:3333</code>. This location is your own computer, so even though it looks like it’s running on the internet, it isn’t. The <code>3333</code> is a ‘port’, meaning that Open Refine is running much like a server, serving up a webpage via that port to the browser. (If the browser window doesn't open automatically, open one and put <code>http://127.0.0.1:3333</code> in the address bar.)</li>
</ol>
<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/4mZOKaxRiqw?rel=0" title="Installing Open Refine" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
<h2 id="start-cleaning-our-texan-correspondence">Start Cleaning our Texan Correspondence</h2>
<p>Make sure you have your data handy that you created in <a href="../supporting materials/regexex/">Module 3, Exercise 1</a>, the Texan correspondence. You can get it out of your DH Box by using the DH Box File Manager. </p>
<ol>
<li>Navigate to where you were working on it, then click on the file name. This will download it to your downloads folder.</li>
<li>Move your working file to somewhere safe on your computer.</li>
<li>Start a new project by clicking on the ‘Create project’ tab on the left side of the screen. </li>
<li>Click on ‘Choose files’ and select the Texan correspondence CSV file. Open Refine will load this data and it will give you a preview of your data. </li>
<li>Name your project in the box on the top right side (eg. 'm3-exercise2' or similar) and then click ‘Create project’. It may take a few minutes.</li>
<li>
<p>Once your project has started, one of the columns that should be visible in your data is "Sender". Click on the arrow to the left of "Sender" in OpenRefine and select Facet -&gt; Text Facet. Do the same with the arrow next to "Recipient". </p>
<p>A box will appear on the left side of the browser showing all 189 names listed as senders in the spreadsheet. The spreadsheet itself is nearly a thousand rows, so immediately we see that, in this correspondence collection, some names are used multiple times. You may also have noticed that many of the names suffered from errors in the text scan (OCR or Optical Character Recognition errors), rendering some identical names from the book as similar, but not the same, in the spreadsheet. For example the recipient "Juan de Dios Cafiedo" is occasionally listed as "Juan de Dios CaAedo". Any subsequent analysis will need these errors to be cleared up, and OpenRefine will help fix them.</p>
</li>
<li>
<p>Within the "Sender" facet box on the left side, click on the button labeled "Cluster". This feature presents various automatic ways of merging values that appear to be the same. </p>
</li>
<li>Play with the values in the drop-down boxes and notice how the number of clusters found change depending on which method is used. Because the methods are slightly different, each will present different matches that may or may not be useful. </li>
<li>If you see two values which should be merged, e.g. "Ashbel Smith" and ". Ashbel Smith", check the box to the right in the 'Merge' column and click the 'Merge Selected &amp; Re-Cluster' button below.</li>
<li>Go through the various cluster methods one-at-a-time, including changing number values, and merge the values which appear to be the same. "Juan de Dios CaAedo" clearly should be merged with "Juan de Dios Cafiedo", however "Correspondent in Tampico" probably should not be merged with "Correspondent at Vera Cruz." Since we are not experts, we will have to use our best judgement in these cases &mdash; or get cracking on some more research to help us make the call. By the end, you should have reduced the number of unique Senders from 189 to around 150. </li>
<li>Repeat these steps with Recipients, reducing unique Recipients from 192 to about 160. </li>
<li>To finish the automatic cleaning of the data, click the arrow next to "Sender" and select 'Edit Cells -&gt; Common transforms -&gt; Trim leading and trailing whitespace'. </li>
<li>Repeat step 12 for "Recipient". The resulting spreadsheet will not be perfect, but it will be much easier to clean by hand than it would have been before taking this step. </li>
<li>Click on ‘Export’ at the top right of the window to get your data back out as a <code>.csv</code> file.</li>
</ol>
<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HWZbydm4iCc?rel=0" title="Cleaning our Correspondence with Open Refine" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
<h2 id="now-what">Now what?</h2>
<p>The text you've just cleaned could now be loaded into something like <a href="http://hdlab.stanford.edu/palladio/">Palladio</a> or <a href="http://gephi.org">Gephi</a> or <a href="https://databasic.io/en/connectthedots/">Connect the Dots</a> for network analysis! However, every network analysis program has its own idiosyncracies. Gephi and Connect the Dots, for instance, can import lists of relationships if the CSV file has columns labelled 'source' and 'target'. (Connect the Dots will <strong>only</strong> accept those two columns, so you'd have to delete the date column if you wanted to give that a try.)</p>
<p>Let's assume that's where we want to visualize and analyze this data. In order to get this correspondence data into a network visualization tool, we will have to rename the "Sender" column to "source" and the "Recipient" column to "target". You could do this in a spreadsheet, of course. But since you have Open Refine running, do the following:</p>
<ol>
<li>In the arrow to the left of Sender in the main OpenRefine window, select Edit column -&gt; Rename this column, and rename the column "source".</li>
<li>In the arrow to the left of Recipient in the main OpenRefine window, select Edit column -&gt; Rename this column, and rename the column "target".</li>
<li>In the top right of the window, select 'Export -&gt; Custom tabular exporter'.</li>
<li>Notice that "source", "target", and "Date" are checked in the content tab; uncheck "Date", as it will not be used in Gephi (networks where the nodes have different dates, ie. dynamic networks, are beyond us for the moment). </li>
<li>Go to the download tab and change the download option from 'Tab-separated values (TSV)' to 'Comma-separated values (CSV)' and press download. The file will likely download to your automatic download directory. We will revisit this file later. </li>
<li>Go ahead and drop this file into the Palladio interface. Do you see any interesting patterns? Make a note!</li>
<li>Upload your cleaned file with a new name back <strong>into</strong> your DH Box; we will use this in the next module.</li>
</ol>
<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UD-VOjXZN4k?rel=0" title="Preparing our file for export" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
<p><strong>Remember to copy your notes and any other information/observations/thoughts to your GitHub repo</strong></p>
<h3 id="optional-going-further-with-open-refine-named-entity-extraction">Optional: Going further with Open Refine &mdash; Named Entity Extraction</h3>
<p>Say we wanted, instead of the correspondence network, a visualization of all the places named in this body of letters. It might be interesting to visualize on a map the changing focus of Texas' diplomatic attention over time. There is a plugin for Open Refine that does what is called <a href="http://en.wikipedia.org/wiki/Named-entity_recognition">Named Entity Extraction</a>. The plugin, and how to install and use it, is available on the <a href="http://freeyourmetadata.org/named-entity-extraction/">Free Your Metadata website</a>.</p>
<ol>
<li>Use regex on your original document containing the letters to clean up the data so that you have one letter per line (rather than the index &mdash; did you notice that the full text of all the letters was in the original file?).</li>
<li>Import the file into Open Refine.</li>
<li>Extract Named Entities.</li>
<li>Visualize the results in a spreadsheet.</li>
<li>Write up a 'how to' in your notebook explaining these steps in detail.</li>
</ol>
<p><strong><a href="https://www.slideshare.net/spaziodati/using-entity-extraction-extension-with-openrefine-and-datatxt-apis">An interesting use case is discussed online</a></strong> and on the <strong><a href="http://freeyourmetadata.org/publications/named-entity-recognition.pdf">Free Your Metadata website (PDF downloads in new tab)</a>.</strong></p>
<p><strong>Further Help:</strong> Visit <a href="http://www.kalanicraig.com/2014/12/aha-2015-managing-and-maintaining-digital-data-getting-started-in-digital-history-intermediate-workshop/">Kalani Craig's page on maintaining digital data</a>.</p>
<h3 id="optional-exploring-other-named-entity-extraction-tools">Optional: Exploring other Named Entity Extraction tools</h3>
<h4 id="voyant-tools-rezoviz">Voyant Tools RezoViz</h4>
<p><a href="https://voyant-tools.org/">Voyant-Tools</a> is a text analysis suite that we will explore in more depth in the <a href="../module-4/Exercises/#exercise-6-text-analysis-with-voyant">Module 4</a>. Feel free to load your material into it and begin exploring; there's nothing you can break. </p>
<p>One interesting tool in Voyant is called <a href="http://docs.voyant-tools.org/tools/rezoviz/">RezoViz</a>, which will extract entities and tie them together into a network based on appearing in the same document. </p>
<ol>
<li>Upload some of your Canadian war diary texts to Voyant-Tools.</li>
<li>In the top right, there's a 'save' icon. </li>
<li>Select 'url for a different tool/skin'. </li>
<li>Select 'RezoViz' from the tools list that pops up. A new URL will appear in the box. </li>
<li>Copy and paste the URL into a new browser window (works best on Chrome).</li>
</ol>
<p>What kinds of questions could this answer?</p>
<h4 id="stanford-ner">Stanford NER</h4>
<ol>
<li>
<p>Download <a href="http://nlp.stanford.edu/software/CRF-NER.shtml">Stanford NER</a>.</p>
<ul>
<li>
<p><a href="http://historyinthecity.blogspot.ca/2014/06/how-to-use-stanfords-ner-and-extract.html">Mac instructions for Stanford NER</a> (this link is to Michelle Moravec's instructions, for Mac).</p>
</li>
<li>
<p>Windows: If you're on windows and want to do this, things are a bit more complicated. Download and unzip the NER package:</p>
<blockquote>
<ul>
<li>
<p>Open a command prompt in the Stanford NER folder on your Windows machine (you can right-click on the folder in your windows explorer, and select ‘Open command prompt here’).</p>
</li>
<li>
<p>Changing the file names as appropriate, type the following as a single line (highlight the text with your mouse &mdash; it scrolls to the right beyond the page, and then copy it):</p>
</li>
</ul>
</blockquote>
<pre><code>    java -mx500m -cp stanford-ner.jar edu.stanford.nlp.ie.crf.CRFClassifier -loadClassifier classifiers/english.all.3class.distsim.crf.ser.gz -textFile texas-letters.txt -outputFormat inlineXML &gt; “my-ner-output.txt”
</code></pre>
<blockquote>
<ul>
<li>
<p>The first bit, <code>java –mx500m</code> says how much memory to use. If you have 1gb of memory available, you can type <code>java –mx 1g</code> (or 2g, or 3g, etc). </p>
</li>
<li>
<p>The next part of the command calls the NER programme itself. You can set which classifier to use after the <code>–loadClassifier classifiers/</code> by typing in the exact file name for the classifier you wish to use (you are telling <code>loadClassifier</code> the exact path to the classifier). </p>
</li>
<li>
<p>At <code>–textFile</code> you give it the name of your input file (on our machine, called <code>texas-letters.txt</code>, and then specify the <code>outputFormat</code>. </p>
</li>
<li>
<p>The <code>&gt;</code> character sends the output to a new text file, here called <code>my-ner-output.txt</code>. </p>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li>
<p>Hit enter, and a few moments later the programme will tell you something along the lines of the following:</p>
<pre><code>CRFCLassifier tagged 375281 words in 13745 documents at 10833.43 words per second
</code></pre>
</li>
<li>
<p>Open the text file in your text editor, and you’ll see an output like the following:</p>
<pre><code>In the name of the &lt;LOCATION&gt; Republic of Texas &lt;/LOCATION&gt;, Free, Sovereign and Independent. 
To all whom these Presents shall come or may in any wise concern. I &lt;PERSON&gt; Sam Houston &lt;/PERSON&gt; 
President thereof send Greeting
</code></pre>
</li>
</ol>
<p>Congratulations! You've tagged a body of letters. What next? You could organize this into XML, you could visualize, you could regex to find and extract all of your locations, or persons, or... there are many possibilities.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ner/" class="btn btn-neutral float-right" title="Stanford Named Entity Recognizer">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../regexex/" class="btn btn-neutral" title="Regex & the Republic of Texas"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../regexex/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ner/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
